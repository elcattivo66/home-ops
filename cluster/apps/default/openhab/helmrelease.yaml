---
apiVersion: helm.toolkit.fluxcd.io/v2beta1
kind: HelmRelease
metadata:
    name: openhab
    namespace: default
spec:
    chart:
        spec:
            chart: app-template
            version: 0.1.1
            interval: 15m
            sourceRef:
                kind: HelmRepository
                name: bjw-s-charts
                namespace: flux-system
    interval: 15m
    values:
        image:
            repository: docker.io/openhab/openhab
            tag: 3.3.0
        env:
            USER_ID: 1000
            GROUP_ID: 1000
            OPENHAB_HTTP_PORT: "8282"
            OPENHAB_HTTPS_PORT: "8443"
            EXTRA_JAVA_OPTS: "-Duser.timezone=Europe/Berlin -Dlog4j2.formatMsgNoLookups=true"

        service:
            main:
                ports:
                    http:
                        port: 8282
        persistence:
            conf:
                enabled: true
                mountPath: /openhab/conf
                type: custom
                volumeSpec:
                    nfs:
                        server: ${NFS_ADDR}
                        path: /home/tonibrix/openhab/conf
            userdata:
                enabled: true
                mountPath: /openhab/userdata
                type: custom
                volumeSpec:
                    nfs:
                        server: ${NFS_ADDR}
                        path: /home/tonibrix/openhab/userdata

        # podSecurityContext:
        #     runAsUser: 1000
        #     runAsGroup: 1000
        #     fsGroup: 1000
        #     fsGroupChangePolicy: OnRootMismatch
# resources:
#   requests:
#     cpu: 23m
#     memory: 2975M
#   limits:
#     memory: 6572M
