---
apiVersion: v1
kind: ConfigMap
metadata:
  name: kyoo-nginx
data:
  nginx-config: |
    pid /tmp/nginx.pid;
    events {
      worker_connections 1024;
    }
    server {
      listen 8901;
      root /usr/share/nginx/html;

      location / {
        proxy_pass http://kyoo-front.default.svc.cluster.local:8901;
        proxy_http_version 1.1;
        proxy_set_header Upgrade $http_upgrade;
        proxy_set_header Connection "upgrade";
      }

      location /api/ {
        proxy_pass http://kyoo-back.default.svc.cluster.local:5000/;
        proxy_http_version 1.1;
        proxy_set_header Upgrade $http_upgrade;
        proxy_set_header Connection "upgrade";
      }
    }
